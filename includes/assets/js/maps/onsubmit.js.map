{"version":3,"sources":["onsubmit.js"],"names":["getFormObj","el","formObj","inputs","$","serializeArray","each","i","input","name","value","toggleDisable","prop","cardflip","element","parent","parentNode","card","find","toggle","nextElementSibling","css","flip_positionattribute","toggleClass","one","off","fireShareEvent","platform","dataLayer","push","event","conv_campaign","window","form_config","analytics_campaign","conv_action","ga_action","conv_label","console","log","socialBlueDeDuplicate","email","phone","apref","apHost","document","location","protocol","apSrc","_apOrderValue","_apOrderNumber","_apRef","append","unescape","err","script","createElement","type","src","getElementsByTagName","appendChild","getUrlVars","hash","vars","hashes","href","split","slice","indexOf","length","on","petition_form_element","this","post_form_value","action","nonce","ad_campaign","ajax","url","ajaxUrl","data","success","consent","fbq","jalt_track","clangct","undefined","dataType","error","jqXHR","textStatus","errorThrown","cardback","hide"],"mappings":"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","file":"../onsubmit.js","sourcesContent":["$('.gpnl-petitionform').on('submit', function () {\n  var petition_form_element = this;\n  // Get the  parameter from the petition form and add the action and CSRF protection\n  var post_form_value = getFormObj(petition_form_element);\n  form_config = 'petition_form_object_' + post_form_value['form_id'];\n    \n  post_form_value.action = 'petition_form_process';\n  post_form_value.nonce  = window[form_config].nonce;\n  post_form_value.ad_campaign = window[form_config].ad_campaign;\n\n  // Disable the form so people can't resubmit\n  toggleDisable($(petition_form_element).find('*'));\n\n  // Do a ajax call to the wp_admin admin_ajax.php,\n  // which triggers processing function in the petition block\n  $.ajax({\n    type:    'POST',\n    url:     window[form_config].ajaxUrl,\n    data:    post_form_value,\n    success: function(data) {\n      console.log('^-^');\n\n      // Send conversion event to the GTM\n      if (typeof dataLayer !== 'undefined') {\n        dataLayer.push({\n          'event'         :'petitiebutton',\n          'conv_campaign' : window[form_config].analytics_campaign,\n          'conv_action'   : window[form_config].ga_action,\n          'conv_label'    :'registreer'\n        });\n      }\n\n      // if the consent was ticked or consent was given by entering phonenumber\n      if (post_form_value.consent === 'on' || post_form_value.phone !== '') {\n        // If an ad campaign is run by an external company fire the conversiontracking\n        if (window[form_config].ad_campaign === 'SB') {\n          fbq('track', 'Lead');\n          // if it is run by social blue, also deduplicate\n          socialBlueDeDuplicate(post_form_value['mail'], data['data']['phone'], window[form_config].apref);\n        } else if (window[form_config].ad_campaign === 'JA') {\n          fbq('track', window[form_config].jalt_track);\n        }\n      }\n\n      if (post_form_value.phone !== ''){\n        // Send conversion event to the GTM\n        if (typeof dataLayer !== 'undefined') {\n          dataLayer.push({\n            'event'         :'petitiebutton',\n            'conv_campaign' : window[form_config].analytics_campaign,\n            'conv_action'   :'telnr',\n            'conv_label'    :'Ja'\n          });\n        }\n      }\n      else{\n        if (typeof dataLayer !== 'undefined') {\n          dataLayer.push({\n            'event'         :'petitiebutton',\n            'conv_campaign' : window[form_config].analytics_campaign,\n            'conv_action'   :'telnr',\n            'conv_label'    :'Nee'\n          });\n        }\n      }\n\n      // cardflip the card, positionattribute flips to make sure no problems arises with different lengths of the front and back of the card, finally hide the front\n      cardflip(petition_form_element);\n\n      let clangct=getUrlVars()['clangct'];\n      if(clangct != undefined){\n        $.ajax({\n          url: '/wp-content/plugins/planet4-gpnl-plugin-blocks/includes/assets/js/clang-conversion.js?clangct='+clangct,\n          dataType: 'script',\n        });\n      }\n    },\n    error: function(jqXHR, textStatus, errorThrown){\n      // If the backend sends an error, hide the thank element and show an error urging to try again\n      console.log('o_o');\n      console.log('ERRORS: ' + textStatus + ': ' + errorThrown);\n      var cardback = $(petition_form_element.parentNode.nextElementSibling);\n      cardback.find('*').hide('');\n      cardback.append('<p>Sorry, er gaat momenteel iets fout, probeer het nu of later opnieuw.</p>');\n      cardback.append(\n        '<a href=\\''+window.location.href +'\\' class=\"btn btn-primary btn-block\"' +\n        '\">Probeer opnieuw</a>');\n      cardflip(petition_form_element);\n    }\n  });\n});\n\n// Get the key+value from the input fields in the form\nfunction getFormObj(el) {\n  var formObj = {};\n  var inputs = $(el).serializeArray();\n  $.each(inputs, function (i, input) {\n    formObj[input.name] = input.value;\n  });\n  return formObj;\n}\n\n// Toggle the disabled state on form elements\nfunction toggleDisable(el) {\n  el.prop('disabled', !el.prop('disabled'));\n\n}\n\n// toggle the flipped class for the card parent\nfunction cardflip(el) {\n  let element = $(el);\n  let parent =  el.parentNode;\n  let card = $(el.parentNode.parentNode);\n\n  // first hide the signing button\n  $(element.find('.signBtn')).toggle();\n  $(element.find('.policies')).toggle();\n  // then cardflip the position attribute on the front and back of the card to support different lengths front and back\n  $(parent.nextElementSibling).css( 'position', flip_positionattribute(parent.nextElementSibling));\n  $(parent).css( 'position', flip_positionattribute(parent));\n  // then cardflip the card\n  card.toggleClass('flipped');\n\n  // after animation hide the front\n  card.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',\n    function() {\n      $(parent).toggle();\n      card.off('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend');\n    });\n\n}\n\nfunction flip_positionattribute (el){\n  return $(el).css('position') === 'absolute' ? 'relative' : 'absolute';\n}\n\n/* eslint-disable */\nfunction fireShareEvent (platform){\n  if (typeof dataLayer !== 'undefined') {\n    dataLayer.push({\n      'event'         :'petitiebutton',\n      'conv_campaign' :window[form_config].analytics_campaign,\n      'conv_action'   :window[form_config].ga_action,\n      'conv_label'    :'share_' + platform});\n  }\n  else{\n    console.log('GTM not defined?');\n  }\n}\n/* eslint-enable */\n\n/* eslint-disable */\n// Send the supporter data to for deduplication\nfunction socialBlueDeDuplicate(email, phone, apref) {\n  var apHost = ('https:' == document.location.protocol ? 'https://secure.event.' : 'http://www.') + 'affiliatepartners.com';\n  var apSrc = '/js/ApConversionPixelV1.1.js';\n\n  _apOrderValue = 0;\n  _apOrderNumber = 'email=' + email + '-telefoonnumer=' + phone;\n  _apRef = apref;\n\n  try {\n    $('body').append(unescape('%3Cscript src=\\'' + apHost + apSrc + '\\' type=\\'text/javascript\\'%3E%3C/script%3E'));\n  } catch (err) {\n    var script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = apHost + apSrc;\n    document.getElementsByTagName('head')[0].appendChild(script);\n  }\n}\n/* eslint-enable */\n\n// REFACTOR IE11 doesn't support UrlSearchParams, so custom UrlParam function.\n// \tConsider polyfilling it now? or wait until we drop IE11 support and switch then?\nfunction getUrlVars(){\n  var vars = [],\n    hash;\n  var uri = window.location.href.split('#')[0];\n  var hashes = uri.slice(window.location.href.indexOf('?') + 1).split('&');\n  for(var i = 0; i < hashes.length; i++){\n    hash = hashes[i].split('=');\n    vars.push(hash[0]);\n    vars[hash[0]] = hash[1];\n  }\n  return vars;\n}\n"]}