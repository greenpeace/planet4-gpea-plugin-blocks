"use strict";function MetaBlock(e){var c=this;c.shortcode_tag=e,c.add_btn_class=c.shortcode_tag+"-add-element",c.remove_btn_class=c.shortcode_tag+"-remove-element",c.render_new=function(){var e=c.get_element_map(),t=c.make_buttons(e);$(".shortcode-ui-edit-"+c.shortcode_tag).append(t);var n=e.element_count;this.hide_all_elements(n),this.add_click_event_handlers(n)},c.render_edit=function(){var e=c.get_element_map(),t=e.element_types,n=e.element_count,a=c.make_buttons(e);$(".shortcode-ui-edit-"+c.shortcode_tag).append(a);var r=[],o=c.get_element_map_array(n,t);o.forEach(function(e){""===$(".field-block").filter($("div[class$='_"+e+"']")).children().filter($("input, textarea, select")).map(function(e,t){return $(t).val()}).get().join("")&&r.push(e)});var l=o.filter(function(e){return!r.includes(e)}),i=0===l.length?0:Math.max.apply(null,l.map(function(e){return parseInt(e.match(/\d+$/g)[0])}));$("."+c.add_btn_class).parent().data("row",i),0!==i&&$("."+c.remove_btn_class).removeAttr("disabled"),r.map(function(e){$(".field-block").filter($("div[class$='_"+e+"']")).hide()}),o.length-r.length===n&&$("."+c.add_btn_class).attr("disabled","disabled"),this.toggle_images(n),this.add_click_event_handlers(n)},c.add_click_event_handlers=function(r){var o=this;$("."+c.add_btn_class).on("click",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent().data("row"),a=t.data("element-type");n<=r&&(o.show_element(++n,a,r),t.parent().data("row",n),$("."+c.remove_btn_class).removeAttr("disabled"),n===r&&$("."+c.add_btn_class).attr("disabled","disabled"))}),$("."+c.remove_btn_class).on("click",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent().data("row");0<=n&&(o.hide_element(n--),t.parent().data("row",n),$("."+c.add_btn_class).removeAttr("disabled"),0===n&&t.attr("disabled","disabled"))}),$("input[name=elements_block_style]").off("click").on("click",function(){c.toggle_images(r)})},c.hide_element=function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']"));t.children().filter($("input, textarea")).each(function(e,t){$(t).val("").trigger("input")}),t.find($(".attachment-previews .remove")).each(function(e,t){$(t).click()}),t.hide(300)},c.hide_all_elements=function(e){c.get_element_map_array(e).forEach(function(e){$(".field-block").filter($("div[class$='_"+e+"']")).hide()})},c.show_element=function(e,t,n){$(".field-block").filter($("div[class$='_"+t+"_"+e+"']")).show(300,function(){c.toggle_images(n),$(".media-frame-content").animate({scrollTop:$(".shortcode-ui-content").prop("scrollHeight")},300)})},c.toggle_images=function(e){c.get_element_map_array(e).forEach(function(e){var t=$(".field-block").filter($("div[class$='title_"+e+"']")).is(":visible"),n="no_image"!=$("input[name=elements_block_style]:checked").val();$(".shortcode-ui-attribute-attachment_"+e).toggle(t&&n)})},c.get_element_map=function(){var n=$("[data-element-type]").map(function(){return $(this).data("element-type")}).toArray();n=n.filter(function(e,t){return n.indexOf(e)==t});var a=$("[data-element-name]").map(function(){return $(this).data("element-name")}).toArray();a=a.filter(function(e,t){return a.indexOf(e)==t});var e=$("[data-element-number]").map(function(){return $(this).data("element-number")}).toArray();return e=Math.max.apply(null,e),{element_types:n,element_names:a,element_count:e}},c.get_element_map_array=function(e,n){var t=Array.apply(null,Array(e));return t=t.map(function(e,t){return t+1}),n&&(t=t.map(function(t){return n.map(function(e){return e+"_"+t},[])}).reduce(function(e,t){return e.concat(t)})),t},c.make_buttons=function(e){var n='<div data-row="0">',t=e.element_types,a=e.element_names;return a.length!==t.length&&(a=t),t.map(function(e,t){n+='<button class="button button-small '+c.add_btn_class+'" data-element-type="'+e+'">Add '+a[t]+"</button>"}),n+='<button class="button button-small '+c.remove_btn_class+'" disabled="disabled">Remove Element</button></div>'}}jQuery(document).ready(function(){var n=["shortcake_metablock","shortcake_mixed_content_row","shortcake_repeater","shortcake_milestones","shortcake_world_slideshow","shortcake_mixed_content_slideshow"];wp.shortcake.hooks.addAction("shortcode-ui.render_new",function(e){var t=e.get("shortcode_tag");n.includes(t)&&new MetaBlock(t).render_new()}),wp.shortcake.hooks.addAction("shortcode-ui.render_edit",function(e){var t=e.get("shortcode_tag");n.includes(t)&&new MetaBlock(t).render_edit()})}),jQuery(document).ready(function(){});
//# sourceMappingURL=maps/admin-blocks.min.js.map
