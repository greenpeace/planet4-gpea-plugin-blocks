"use strict";function MetaBlock(e,t){var s=this;s.shortcode_tag=e,s.add_btn_class=s.shortcode_tag+"-add-element",s.remove_btn_class=s.shortcode_tag+"-remove-element",s.required_image=t||!1,s.render_new=function(){var e=s.get_element_map(),t=s.make_buttons(e);$(".shortcode-ui-edit-"+s.shortcode_tag).append(t);var n=e.element_count;this.hide_all_elements(n),this.add_click_event_handlers(n)},s.render_edit=function(){var e=s.get_element_map(),t=e.element_types,n=e.element_count,a=s.make_buttons(e);$(".shortcode-ui-edit-"+s.shortcode_tag).append(a);var r=[],o=s.get_element_map_array(n,t);o.forEach(function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']")),n=t.children().filter($("input, textarea, select")).map(function(e,t){return $(t).val()}).get().join(""),a=s.required_image?t.find(".attachment-previews .attachment-preview"):null;""!==n||s.required_image&&0!=a.length||r.push(e)});var i=o.filter(function(e){return!r.includes(e)}),c=0===i.length?0:Math.max.apply(null,i.map(function(e){return parseInt(e.match(/\d+$/g)[0])}));$("."+s.add_btn_class).parent().data("row",c),0!==c&&$("."+s.remove_btn_class).removeAttr("disabled"),r.map(function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']"));t.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1).trigger("change"),t.hide()}),o.length-r.length===n&&$("."+s.add_btn_class).attr("disabled","disabled"),this.toggle_images(n),this.add_click_event_handlers(n)},s.add_click_event_handlers=function(o){var i=this;$("."+s.add_btn_class).on("click",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent().data("row"),a=t.data("element-type");if("post"==a){var r='select[name="post_post_'+(n+1)+'"]';"js-select2-enable"===$(r).data("input-transform")&&$(r).select2({placeholder:"Select post"})}n<=o&&(i.show_element(++n,a,o),t.parent().data("row",n),$("."+s.remove_btn_class).removeAttr("disabled"),n===o&&$("."+s.add_btn_class).attr("disabled","disabled"))}),$("."+s.remove_btn_class).on("click",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent().data("row");0<=n&&(i.hide_element(n--),t.parent().data("row",n),$("."+s.add_btn_class).removeAttr("disabled"),0===n&&t.attr("disabled","disabled"))}),$("input[name=elements_block_style]").off("click").on("click",function(){s.toggle_images(o)})},s.hide_element=function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']"));t.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1).trigger("change"),t.find('input:not([type="checkbox"]):not([type="radio"]), textarea').val("").trigger("input").trigger("change"),s.required_image&&t.find(".attachment-previews .attachment-preview .button.remove").trigger("click"),t.hide(300)},s.hide_all_elements=function(e){s.get_element_map_array(e).forEach(function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']"));t.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1).trigger("change"),t.hide()})},s.show_element=function(e,t,n){$(".field-block").filter($("div[class$='_"+t+"_"+e+"']")).show(300,function(){$(this).find('input[type="checkbox"][checked], input[type="radio"][checked]').each(function(){$(this).prop("checked",!0).trigger("change")}),s.toggle_images(n),$(".media-frame-content").animate({scrollTop:$(".shortcode-ui-content").prop("scrollHeight")},300)})},s.toggle_images=function(e){s.get_element_map_array(e).forEach(function(e){var t=$(".field-block").filter($("div[class$='title_"+e+"']")).is(":visible"),n="no_image"!=$("input[name=elements_block_style]:checked").val();$(".shortcode-ui-attribute-attachment_"+e).toggle(t&&n)})},s.get_element_map=function(){var n=$("[data-element-type]").map(function(){return $(this).data("element-type")}).toArray();n=n.filter(function(e,t){return n.indexOf(e)==t});var a=$("[data-element-name]").map(function(){return $(this).data("element-name")}).toArray();a=a.filter(function(e,t){return a.indexOf(e)==t});var e=$("[data-element-number]").map(function(){return $(this).data("element-number")}).toArray();return e=Math.max.apply(null,e),$("[data-hidden]").each(function(){$(this).closest(".field-block").parent("div").hide()}),{element_types:n,element_names:a,element_count:e}},s.get_element_map_array=function(e,n){var t=Array.apply(null,Array(e));return t=t.map(function(e,t){return t+1}),n&&(t=t.map(function(t){return n.map(function(e){return e+"_"+t},[])}).reduce(function(e,t){return e.concat(t)})),t},s.make_buttons=function(e){var n='<div data-row="0">',t=e.element_types,a=e.element_names;return a.length!==t.length&&(a=t),t.map(function(e,t){n+='<button class="button button-small '+s.add_btn_class+'" data-element-type="'+e+'">Add '+a[t]+"</button>"}),n+='<button class="button button-small '+s.remove_btn_class+'" disabled="disabled">Remove Element</button></div>'}}jQuery(document).ready(function(){var n=["shortcake_metablock","shortcake_mixed_content_row","shortcake_repeater","shortcake_milestones","shortcake_slideshow","shortcake_world_slideshow","shortcake_link_list","shortcake_people_list","shortcake_accordion_list","shortcake_launcher_card","shortcake_grid_images","shortcake_donation_block","shortcake_hero_set","shortcake_steps_set","shortcake_geography_set","shortcake_infographic_cards","shortcake_testimony","shortcake_mc_subscription"],a=["shortcake_grid_images","shortcake_hero_set","shortcake_steps_set","shortcake_infographic_cards","shortcake_testimony"];wp.shortcake.hooks.addAction("shortcode-ui.render_new",function(e){var t=e.get("shortcode_tag");n.includes(t)&&new MetaBlock(t,a.includes(t)).render_new()}),wp.shortcake.hooks.addAction("shortcode-ui.render_edit",function(e){var t=e.get("shortcode_tag");n.includes(t)&&new MetaBlock(t,a.includes(t)).render_edit()})});
//# sourceMappingURL=maps/admin-blocks.min.js.map
