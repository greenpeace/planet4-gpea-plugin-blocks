"use strict";function MetaBlock(e){var i=this;i.shortcode_tag=e,i.add_btn_class=i.shortcode_tag+"-add-element",i.remove_btn_class=i.shortcode_tag+"-remove-element",i.render_new=function(){var e=i.get_element_map(),t=i.make_buttons(e);$(".shortcode-ui-edit-"+i.shortcode_tag).append(t);var n=e.element_count;this.hide_all_elements(n),this.add_click_event_handlers(n)},i.render_edit=function(){var e=i.get_element_map(),t=e.element_types,n=e.element_count,a=i.make_buttons(e);$(".shortcode-ui-edit-"+i.shortcode_tag).append(a);var r=[],l=i.get_element_map_array(n,t);l.forEach(function(e){""===$(".field-block").filter($("div[class$='_"+e+"']")).children().filter($("input, textarea, select")).map(function(e,t){return $(t).val()}).get().join("")&&r.push(e)});var o=l.filter(function(e){return!r.includes(e)}),c=0===o.length?0:Math.max.apply(null,o.map(function(e){return parseInt(e.match(/\d+$/g)[0])}));$("."+i.add_btn_class).parent().data("row",c),0!==c&&$("."+i.remove_btn_class).removeAttr("disabled"),r.map(function(e){$(".field-block").filter($("div[class$='_"+e+"']")).hide()}),l.length-r.length===n&&$("."+i.add_btn_class).attr("disabled","disabled"),this.toggle_images(n),this.add_click_event_handlers(n)},i.add_click_event_handlers=function(l){var o=this;$("."+i.add_btn_class).on("click",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent().data("row"),a=t.data("element-type");if("post"==a){var r='select[name="post_post_'+(n+1)+'"]';"js-select2-enable"===$(r).data("input-transform")&&$(r).select2({placeholder:"Select post"})}n<=l&&(o.show_element(++n,a,l),t.parent().data("row",n),$("."+i.remove_btn_class).removeAttr("disabled"),n===l&&$("."+i.add_btn_class).attr("disabled","disabled"))}),$("."+i.remove_btn_class).on("click",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent().data("row");0<=n&&(o.hide_element(n--),t.parent().data("row",n),$("."+i.add_btn_class).removeAttr("disabled"),0===n&&t.attr("disabled","disabled"))}),$("input[name=elements_block_style]").off("click").on("click",function(){i.toggle_images(l)})},i.hide_element=function(e){var t=$(".field-block").filter($("div[class$='_"+e+"']"));t.children().filter($("input, textarea")).each(function(e,t){$(t).val("").trigger("input").trigger("change")}),t.hide(300)},i.hide_all_elements=function(e){i.get_element_map_array(e).forEach(function(e){$(".field-block").filter($("div[class$='_"+e+"']")).hide()})},i.show_element=function(e,t,n){$(".field-block").filter($("div[class$='_"+t+"_"+e+"']")).show(300,function(){i.toggle_images(n),$(".media-frame-content").animate({scrollTop:$(".shortcode-ui-content").prop("scrollHeight")},300)})},i.toggle_images=function(e){i.get_element_map_array(e).forEach(function(e){var t=$(".field-block").filter($("div[class$='title_"+e+"']")).is(":visible"),n="no_image"!=$("input[name=elements_block_style]:checked").val();$(".shortcode-ui-attribute-attachment_"+e).toggle(t&&n)})},i.get_element_map=function(){var n=$("[data-element-type]").map(function(){return $(this).data("element-type")}).toArray();n=n.filter(function(e,t){return n.indexOf(e)==t});var a=$("[data-element-name]").map(function(){return $(this).data("element-name")}).toArray();a=a.filter(function(e,t){return a.indexOf(e)==t});var e=$("[data-element-number]").map(function(){return $(this).data("element-number")}).toArray();return e=Math.max.apply(null,e),{element_types:n,element_names:a,element_count:e}},i.get_element_map_array=function(e,n){var t=Array.apply(null,Array(e));return t=t.map(function(e,t){return t+1}),n&&(t=t.map(function(t){return n.map(function(e){return e+"_"+t},[])}).reduce(function(e,t){return e.concat(t)})),t},i.make_buttons=function(e){var n='<div data-row="0">',t=e.element_types,a=e.element_names;return a.length!==t.length&&(a=t),t.map(function(e,t){n+='<button class="button button-small '+i.add_btn_class+'" data-element-type="'+e+'">Add '+a[t]+"</button>"}),n+='<button class="button button-small '+i.remove_btn_class+'" disabled="disabled">Remove Element</button></div>'}}jQuery(document).ready(function(){var n=["shortcake_metablock","shortcake_mixed_content_row","shortcake_repeater","shortcake_milestones","shortcake_slideshow","shortcake_world_slideshow","shortcake_link_list","shortcake_people_list","shortcake_accordion_list","shortcake_launcher_card"];wp.shortcake.hooks.addAction("shortcode-ui.render_new",function(e){var t=e.get("shortcode_tag");n.includes(t)&&new MetaBlock(t).render_new()}),wp.shortcake.hooks.addAction("shortcode-ui.render_edit",function(e){var t=e.get("shortcode_tag");n.includes(t)&&new MetaBlock(t).render_edit()})});
//# sourceMappingURL=maps/admin-blocks.min.js.map
